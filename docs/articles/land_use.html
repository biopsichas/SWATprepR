<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="svatools">
<title>Land use • svatools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Land use">
<meta property="og:description" content="svatools">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">svatools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/calibration.html">Calibration data</a>
    <a class="dropdown-item" href="../articles/weather.html">Weather data</a>
    <a class="dropdown-item" href="../articles/soil.html">Soil parameters</a>
    <a class="dropdown-item" href="../articles/deposition.html">Atmospheric deposition</a>
    <a class="dropdown-item" href="../articles/land_use.html">Land use</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/biopsichas/svatools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Land use</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biopsichas/svatools/blob/HEAD/vignettes/land_use.Rmd" class="external-link"><code>vignettes/land_use.Rmd</code></a></small>
      <div class="d-none name"><code>land_use.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Preparation of land use data for the <a href="https://git.ufz.de/optain/wp4-integrated-assessment/swat/bildr_script" class="external-link">SWATbuildR</a><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Currently requires access to OPTAIN &lt;a href="https://git.ufz.de/optain" class="external-link uri"&gt;https://git.ufz.de/optain&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a> is among
the most difficult tasks as it requires collection and combination of
multiple GIS datasets (crop land, tile drain extent, Natural/Small Water
Retention Measures (NSWRMs) installation sites, etc.). Moreover, it also
requires putting a lot of efforts into cleaning topological issues from
prepared layer. However, even more difficult task is to prepare land use
time series data required for the preparation of <a href="https://swatplus.gitbook.io/docs/user/editor/inputs/land-use-management#management-schedules" class="external-link">management
schedules</a> necessary for <a href="https://swat.tamu.edu/software/plus/" class="external-link">SWAT+ model</a>. This page
will provide tools (or links to them) and workflow to help with this
task. Particular focus is paid for preparing land use time series data
(when local data are not available) from remote sensing sources required
for <a href="http://chrisschuerz.github.io/SWATfarmR/" class="external-link">SWATfarmR</a>
tool.</p>
</div>
<div class="section level2">
<h2 id="land-use-layer">Land use layer<a class="anchor" aria-label="anchor" href="#land-use-layer"></a>
</h2>
<p>Merging different data sets, cleaning topological errors and
preparing the final layer directly usable in <code>SWATbuildR</code> is
a quite time consuming task. It can be done with the Python script we
have prepared for such task. This script with an example data is
available on <a href="https://doi.org/10.5281/zenodo.7509101" class="external-link">zenodo
page</a>. <code>arcpy</code> library is required with ArcGIS
<em>Advanced</em> license.</p>
<p>In order to run scrip following GIS datasets should be collected:</p>
<ul>
<li>General land cover covering all area (raster);</li>
<li>Catchment boundary (polygon);</li>
<li>Crop fields (polygon);</li>
<li>River channels (line);</li>
<li>Tile drain extent (polygon);</li>
<li>Measure extent (polygon)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Any number of these layers can be used&lt;/p&gt;"><sup>2</sup></a>.</li>
</ul>
<p>These GIS layers should be adjusted to fit structure of example data
or the script should be adjusted to fit input data structure. After
successfully running script resulting data layer should be inline with
<code>SWATbuildR</code> requirements (please see <a href="https://doi.org/10.5281/zenodo.7463395" class="external-link">SWAT+ modeling
protocol</a> sections 2.2 and 2.3). An example of data structure is
provided below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Loading libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/biopsichas/svatools" class="external-link">svatools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">##Loading data</span></span>
<span><span class="va">lu_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/lu_layer.shp"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="va">lu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">lu_path</span>,  quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">##Adding IDs to land use field data and selected required columns</span></span>
<span><span class="va">lu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">lu</span>, id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">type</span>, <span class="va">drainage</span>, <span class="va">measures</span><span class="op">)</span></span>
<span><span class="co">##Printing structure of the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">lu</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Classes 'sf' and 'data.frame':   10443 obs. of  5 variables:</span></span>
<span><span class="co">##  $ id      : int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ type    : chr  "wwht" "wwht" "corn" "wwht" ...</span></span>
<span><span class="co">##  $ drainage: int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ measures: chr  NA NA NA NA ...</span></span>
<span><span class="co">##  $ geometry:sfc_POLYGON of length 10443; first list element: List of 1</span></span>
<span><span class="co">##   ..$ : num [1:16, 1:2] 479720 479710 479697 479698 479669 ...</span></span>
<span><span class="co">##   ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"</span></span>
<span><span class="co">##  - attr(*, "sf_column")= chr "geometry"</span></span>
<span><span class="co">##  - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:4] "id" "type" "drainage" "measures"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="remote-sensing">Remote sensing<a class="anchor" aria-label="anchor" href="#remote-sensing"></a>
</h2>
<p>SWAT+ model has important capabilities to simulate impacts of
agriculture on water flows and water quality in water bodies. However,
this requires information about agricultural activities in a selected
area. One of the most important is crop rotation data. Yet, such
information rarely is available or freely accessible. In such cases
remote sensing data could be used to generate information about crops
for selected time period. More information about this is provided in <a href="https://doi.org/10.5281/zenodo.7463395" class="external-link">SWAT+ modeling
protocol</a> section 4.1.1).</p>
<div class="section level3">
<h3 id="google-earth-script">Google Earth script<a class="anchor" aria-label="anchor" href="#google-earth-script"></a>
</h3>
<p>In the framework of the <a href="https://www.optain.eu/" class="external-link">OPTAIN
project</a> deliverable 3.2 <span class="citation">(Szabó et al.
2022)</span>, a <a href="https://code.earthengine.google.com/" class="external-link">Google
Earth Engine-based</a> script <span class="citation">(Mészáros and Szabó
2022)</span> was developed to predict crop types with the random forest
method based on time series reflectance data of <a href="https://sentinel.esa.int/web/sentinel/missions/sentinel-1" class="external-link">Sentinel</a>
1A and 1B satellite radar images. Output of the script is a series of
crop maps starting from the year 2015 to latest available year. Required
input data:</p>
<ul>
<li>Catchment boundary;</li>
<li>Training points;</li>
<li>Parcel/field boundaries.</li>
</ul>
</div>
<div class="section level3">
<h3 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h3>
<p>Training data is necessary for the classification algorithm. In case
no crop types data is available <a href="https://esdac.jrc.ec.europa.eu/projects/lucas" class="external-link">LUCAS: Land Use and
Coverage Area frame Survey</a> data can be used. In our case we had
local data for year 2021. This was used for the preparation of training
set.</p>
<p>However, before generating training set for a remote sensing
algorithm is good practice to examine input data. In an example below,
areas for each land use/crop type were calculated and provided as a
figure. As a general recommendation land use/crop types with very small
areas should be eliminated from further workflow. In provided example
crop types with areas occupying less than <em>0.1%</em> were assigned
general code <em>“agrl”</em>. Thus eliminated from further workflow.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Calculating areas in ha and % for land uses/crops</span></span>
<span><span class="va">lu_area</span> <span class="op">&lt;-</span> <span class="va">lu</span><span class="op">[</span><span class="st">"type"</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">area</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">lu_area</span><span class="op">[</span><span class="st">"Sum"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lu_area</span><span class="op">$</span><span class="va">area</span><span class="op">)</span></span>
<span><span class="va">lu_area</span><span class="op">[</span><span class="st">"Area [%]"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">lu_area</span><span class="op">$</span><span class="va">area</span><span class="op">/</span><span class="va">lu_area</span><span class="op">$</span><span class="va">Sum</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">##Printing figure</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">lu_area</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">`Area [%]`</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">`Area [%]`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">type</span>, label <span class="op">=</span> <span class="va">`Area [%]`</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"area in %"</span>, x <span class="op">=</span> <span class="st">"crops/land use"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="land_use_files/figure-html/lu_view-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Eliminating very small types</span></span>
<span><span class="va">lu</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="va">lu</span><span class="op">$</span><span class="va">type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"past"</span>, <span class="st">"herb"</span>, <span class="st">"csil"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"agrl"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-data">Training data<a class="anchor" aria-label="anchor" href="#training-data"></a>
</h3>
<p>Remote sensing script requires training points with information about
year and land use/crop type. Such data can be prepared with <a href="../reference/get_lu_points.html">get_lu_points</a> function. This
function requires preparation of <em>lookup</em> table where each land
use has assigned numeric code. Moreover, some land use type as forest,
water, urban land uses also will not be participating in the rotation.
These should be set aside.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparation of lookup table</span></span>
<span><span class="va">lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lc1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lu</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lu</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##Setting, which land uses will not change </span></span>
<span><span class="va">lu_constant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fesc"</span>, <span class="st">"orcd"</span>, <span class="st">"frst"</span>, <span class="st">"frse"</span>, <span class="st">"frsd"</span>, <span class="st">"urld"</span>, <span class="st">"urhd"</span>, <span class="st">"wetl"</span>, <span class="st">"watr"</span>, <span class="st">"agrl"</span><span class="op">)</span></span>
<span><span class="co">##Obtaining training data</span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_lu_points.html">get_lu_points</a></span><span class="op">(</span><span class="va">lu</span>, <span class="fl">2021</span>, <span class="va">lookup</span>, <span class="va">lu_constant</span><span class="op">)</span></span>
<span><span class="co">##Plotting points to be used in remote sensing algorithm training </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">lookup</span>, by <span class="op">=</span> <span class="st">"lc1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Paired"</span>, name <span class="op">=</span> <span class="st">"Crop type"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="land_use_files/figure-html/lu_pts-1.png" width="700"></p>
<p>GIS layers have to be prepared and saved into <em>.shp</em> files to
be transferred to the Google Earth Engine. These files can be directly
used with the classification script.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparing just the boundary data for fields</span></span>
<span><span class="va">parcels</span> <span class="op">&lt;-</span> <span class="va">lu</span><span class="op">[</span><span class="st">"id"</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">##Preparing basin data </span></span>
<span><span class="va">output_path</span> <span class="op">&lt;-</span> <span class="st">"../output/"</span></span>
<span><span class="va">basin_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/basin.shp"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="va">catchment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">basin_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">basin</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Upper_Zglowiaczka"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">##Writing all the necessary training data for remote sensing algorithm.</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">pts</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"pts.shp"</span><span class="op">)</span>, append <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">parcels</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"lu_prcl.shp"</span><span class="op">)</span>, append <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">catchment</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"catchment.shp"</span><span class="op">)</span>, append <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rotation-extraction">Rotation extraction<a class="anchor" aria-label="anchor" href="#rotation-extraction"></a>
</h3>
<p>Running <a href="https://code.earthengine.google.com/" class="external-link">Google Earth
Engine-based</a> script prepared by <span class="citation">Mészáros and
Szabó (2022)</span> generates <em>.tif</em> raster file with bands for
each year land use/crop types (represented by numeric codes). One year
example of classification results are provided below.</p>
<p><img src="Rplot1.png" width="80%" style="display: block; margin: auto;"></p>
<p>For this <em>.tif</em> file <a href="../reference/extract_rotation.html">extract_rotation</a> function
can be applied to extract all crop rotation information. This
information is delivered in a format directly usable by <a href="http://chrisschuerz.github.io/SWATfarmR/" class="external-link">SWATfarmR</a> input data
preparation scripts, which are applied to generate SWAT+ management crop
<a href="https://swatplus.gitbook.io/docs/user/editor/inputs/land-use-management#management-schedules" class="external-link">rotation
schedules</a>. In our example complex rotations for period 2015-2022
were extracted for each field from remote sensing classification
results. Results were saved in a new shape file. Attribute table example
is printed below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Loading results for accuracy</span></span>
<span><span class="va">lu_rot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_rotation.html">extract_rotation</a></span><span class="op">(</span><span class="va">lu</span>, <span class="fl">2015</span>, <span class="st">"cropmaps2015_2022.tif"</span>, <span class="st">"../output/"</span>, <span class="va">lookup</span>, <span class="va">lu_constant</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Overwriting 2021 year classification results since actual data were available.</span></span>
<span><span class="va">lu_rot</span> <span class="op">&lt;-</span> <span class="va">lu_rot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>y_2021 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y_2021</span><span class="op">)</span>, <span class="va">type</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">type</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Writing results for SWATfarmR input preparation functions</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">lu_rot</span> , <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"lu_rot.shp"</span><span class="op">)</span>, append <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co"># write.csv(lu_rot %&gt;% st_drop_geometry(), "lu_rot.csv", row.names = F)</span></span></code></pre></div>
<p>Example of prepared attribute table is provided below. It fulfills
requirements set in <a href="https://doi.org/10.5281/zenodo.7463395" class="external-link">SWAT+ modeling
protocol</a> section 4.1.1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lu_rot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"lu_rot.csv"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lu_rot_df</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          lu y_2015 y_2016 y_2017 y_2018 y_2019 y_2020 y_2021 y_2022</span></span>
<span><span class="co">## 1   field_1   trit   trit   trit   trit   corn   corn   wwht   wwht</span></span>
<span><span class="co">## 2   field_2   wwht   wwht   wwht   wwht   wwht   wwht   wwht   corn</span></span>
<span><span class="co">## 3   field_3   canp   canp   corn   alfa   corn   alfa   corn   corn</span></span>
<span><span class="co">## 4   field_4   trit   alfa   corn   corn   mint   trit   wwht   corn</span></span>
<span><span class="co">## 5   field_5   alfa   alfa   alfa   alfa   mint   mint   wwht   alfa</span></span>
<span><span class="co">## 6   field_6   barl   alfa   corn   onio   barl   corn   corn   trit</span></span>
<span><span class="co">## 7   field_7   sgbt   canp   sgbt   lett   lett   lett   corn   corn</span></span>
<span><span class="co">## 8   field_8   wwht   barl   sgbt   sgbt   sgbt   sgbt   wwht   barl</span></span>
<span><span class="co">## 9   field_9   barl   corn   barl   wwht   mint   mint   mint   mint</span></span>
<span><span class="co">## 10 field_10   sgbt   corn   mint   mint   barl   wwht   mint   mint</span></span></code></pre>
<p>Prepared attribute table can be looped, if longer time series of crop
rotation data is needed. Following lines provides example how time
series could be extended.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span><span class="op">=</span><span class="fl">1</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">lu_rot</span></span>
<span><span class="co">##Loop to extend time series</span></span>
<span><span class="kw">while</span><span class="op">(</span><span class="va">i</span> <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">lu_rot_df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="va">i</span> <span class="op">+</span><span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="co">##Write the column names and the final file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lu"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"y_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1983</span>,<span class="fl">2022</span><span class="op">)</span><span class="op">)</span>, <span class="st">"geometry"</span><span class="op">)</span></span>
<span><span class="co">##To get 33 years exact</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_path</span>, <span class="st">"lu_rot_final.shp"</span><span class="op">)</span>, append <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-meszaros2022" class="csl-entry">
Mészáros, János, and Brigitta Szabó. 2022. <em><span class="nocase">Script to derive and apply crop classification based on
Sentinel 1 satellite radar images in Google Earth Engine
platform</span></em> (version cropmap). Zenodo. <a href="https://doi.org/10.5281/zenodo.6700122" class="external-link">https://doi.org/10.5281/zenodo.6700122</a>.
</div>
<div id="ref-szabo-2022" class="csl-entry">
Szabó, B., J. Mészáros, P. Kassai, P. Braun, A. Nemes, C. Farkas, N.
Čerkasova, F. Monaco, E. A. Chiaradia, and F. Witing. 2022.
<span>“Solutions to Overcome Data Scarcity. Deliverable D3.2 EU Horizon
2020 OPTAIN Project, Grant Agreement No. 862756.”</span>
</div>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Svajunas Plunge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
