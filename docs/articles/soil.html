<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="svatools">
<title>Soil parameters • svatools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Soil parameters">
<meta property="og:description" content="svatools">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">svatools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/calibration.html">Calibration data</a>
    <a class="dropdown-item" href="../articles/deposition.html">Atmospheric deposition</a>
    <a class="dropdown-item" href="../articles/land_use.html">Land use</a>
    <a class="dropdown-item" href="../articles/soil.html">Soil parameters</a>
    <a class="dropdown-item" href="../articles/weather.html">Weather data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/biopsichas/svatools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Soil parameters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biopsichas/svatools/blob/HEAD/vignettes/soil.Rmd" class="external-link"><code>vignettes/soil.Rmd</code></a></small>
      <div class="d-none name"><code>soil.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Obtaining soil parameters for <a href="https://swatplus.gitbook.io/docs/user/editor/inputs/soils" class="external-link">SWAT+
model</a> can be difficult. Therefore package has functions with allows
automatic preparation of soil parameters. Important theoretical
documentation for the equations is presented in the section 3.4 of <a href="https://doi.org/10.5281/zenodo.7463395" class="external-link">SWAT+ modelling
protocol</a>.</p>
<p>For populating SWAT+ <em>usersoil</em> parameter table <em>SOL_Z</em>
(depth of layer), <em>CLAY</em> (percentage of clay defined as particles
&lt;2 <span class="math inline">\(\mu m\)</span>), <em>SAND</em>
(percentage of sand - 50–2000 <span class="math inline">\(\mu
m\)</span>), <em>SILT</em> (percentage of silt - 2–50 <span class="math inline">\(\mu m\)</span>) and <em>OC</em> (same as
<em>SOL_CBN</em>, soil organic carbon content in %) parameters should be
collected per each separate soil type profile’s layer. Other parameters
will be filled by <a href="../reference/get_soil_parameters.html">get_soil_parameters</a> and
<a href="../reference/get_hsg.html">get_hsg</a> functions. For assigning
Hydrologic Soil Groups tile drainage, water level and impervious layer
depth data are needed.</p>
<p>The preparation of soil data and parameters could be done using
following workflow. However, depending on available types of data,
different steps might needed. This is an example of Polish case study of
<a href="https://www.optain.eu/case-studies-and-actors-involvement/upper-zglowiaczka" class="external-link">Upper
Zglowiaczka in OPTAIN project</a>.</p>
</div>
<div class="section level3">
<h3 id="loading-libraries-and-paths-to-data">Loading libraries and paths to data<a class="anchor" aria-label="anchor" href="#loading-libraries-and-paths-to-data"></a>
</h3>
<p>Workflow presented here needs 6 R packages. However, only
<code>svatools</code> and <code>euptf2</code> libraries are required for
the population of soil parameter’s table with <a href="../reference/get_soil_parameters.html">get_soil_parameters</a> and
<a href="../reference/get_hsg.html">get_hsg</a> functions presented in
<a href="#par_make">Adding soil parameters to user table</a> step. Input
for this step could be prepared in various ways. Here is presented just
one of the way to understand better all work process to develop soil
parameters table.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Required</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/biopsichas/svatools" class="external-link">svatools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">euptf2</span><span class="op">)</span></span>
<span><span class="co">##Optional</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Required</span></span>
<span><span class="co">##Path to soil distribution shape file</span></span>
<span><span class="va">soil_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/soils.shp"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="co">##Path to soil lookup initial parameters with SOL_Z, CLAY, SILT, OC parameters filled.</span></span>
<span><span class="va">lookup_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"soil_lookup.xlsx"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="co">##Path to tile drainage shape file</span></span>
<span><span class="va">drainage_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/drained.shp"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Optional</span></span>
<span><span class="co">##Path to water level depth shape file</span></span>
<span><span class="va">water_l_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/water_level.shp"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="co">##Path to DEM raster file</span></span>
<span><span class="va">DEM_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/DEM.tif"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="co">##Path to catchment boundary shape file (which in this case used as impervious layer data)</span></span>
<span><span class="va">basin_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/basin.shp"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="co">##Path to soil hydro groups</span></span>
<span><span class="va">hsg_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/hydgrp.shp"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="preparing-input-data">Preparing input data<a class="anchor" aria-label="anchor" href="#preparing-input-data"></a>
</h3>
<p>Lookup table contains two sheets. One about granulometry
(<em>SAND</em>, <em>SILT</em>, <em>CLAY</em> content) of each soil
texture class. Second about humus content in different humus class soils
(distributed through layers), which could be easily recalculated to
organic carbon content (with division by <em>1.72</em> coefficient).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading granulometry lookup information for soil types into dataframe</span></span>
<span><span class="va">gran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">lookup_path</span>, sheet <span class="op">=</span> <span class="st">"SandSiltClay"</span><span class="op">)</span> </span>
<span><span class="co">##Print example of gran table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gran</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">##   `Texture EN`  SAND  SILT  CLAY</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> CL            32.0  42.9 25.1 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> L             52.3  29.4 18.2 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> LS1           87.2  10.3  2.46</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading humus lookup information in to dataframe and converting it into organic carbon %.</span></span>
<span><span class="va">humus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">lookup_path</span>, sheet <span class="op">=</span> <span class="st">"Humus"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>OC1 <span class="op">=</span> <span class="va">`Humus 1st layer [%]`</span><span class="op">/</span><span class="fl">1.72</span>,</span>
<span>         OC2 <span class="op">=</span> <span class="va">`Humus 2nd layer [%]`</span><span class="op">/</span><span class="fl">1.72</span>,</span>
<span>         OC3 <span class="op">=</span> <span class="va">`Humus 3rd layer [%]`</span><span class="op">/</span><span class="fl">1.72</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Humus</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"OC"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##Print example of humus table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">humus</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">##   Humus   OC1   OC2   OC3</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1  1.88 0.942 0.174</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2  1.63 0.814 0.151</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3  1.26 0.628 0.116</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading GIS layers for basin boundary, water level, drainage status, soils (with "Code" column here representing soil types) and soil hydrological groups.</span></span>
<span><span class="co">##All data should be in one coordinate system.</span></span>
<span><span class="co">##Impervious layer is prepared from basin layer as it is below 1 m whole catchment falls into one category. </span></span>
<span><span class="va">impervious</span><span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">basin_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Impervious <span class="op">=</span> <span class="st">"&gt;100cm"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span>
<span><span class="va">water_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">water_l_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span>
<span><span class="va">drainage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">drainage_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span>
<span><span class="va">soils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">soil_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span>
<span><span class="va">hsg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">hsg_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span></code></pre></div>
<p>All required GIS input data are presented in the maps below. Polygons
in the impervious layer should have one of three possible categories:
“&lt;50cm”, “50-100cm” and “&gt;100cm”. If no information is available
impervious layer depth could be assumed to be the depth of last soil
layer and then reclassified into one of the three categories. Water
level depth also should have only three categories: “&lt;60cm”,
“60-100cm” and “&gt;100cm”. If information is not available soil types
and land use could serve as a good proxy for this information. For
instance wet areas as wetlands could probably be assigned with
“&lt;60cm” class, areas with dominant organic soils with “60-100cm”,
etc. Drainage status should be divided into two: “Y” for drained areas,
“N” for areas without working tile drains. If no database available,
information about existence of drains might be available in drainage
installation plans.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparing maps for each GIS data</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">impervious</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Impervious</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">water_level</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">drainage</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Drained</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">soils</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Code</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##Combining into one</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, ncol <span class="op">=</span> <span class="fl">2</span>,  </span>
<span>                   labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Impervious depth'</span>, <span class="st">'Water level'</span>, <span class="st">'Drainage status'</span>, <span class="st">'Soil types'</span><span class="op">)</span>, </span>
<span>                   label_x <span class="op">=</span> <span class="fl">0</span>, label_y <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, label_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_print-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="preparing-final-soil-layer">Preparing final soil layer<a class="anchor" aria-label="anchor" href="#preparing-final-soil-layer"></a>
</h3>
<p>The final soil layer should have information added from GIS layers to
soil types. For instance in our example initial soil type code has 4
elements separated by “_“. So it looks as <em>S3_S3_SL3_3</em>. First
three shows texture class of soil granulometry three layers and the last
number humus class.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Printing example of soil codes before intersection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Code</span></span>
<span><span class="co">## 1   S3_S3_SL3_3</span></span>
<span><span class="co">## 2  SL2_S3_SL3_3</span></span>
<span><span class="co">## 3 SL3_SL3_SL3_1</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Counting number of unique soil types in input soil data</span></span>
<span><span class="va">soils_n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">unique</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">soils</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">impervious</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">water_level</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">drainage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SNAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Code</span>, <span class="st">"_"</span>, <span class="va">Impervious</span>, <span class="st">"_"</span>, <span class="va">Depth</span>, <span class="st">"_"</span>, <span class="va">Drained</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SNAM</span><span class="op">)</span> </span>
<span><span class="co">##Counting number of unique soil types in generated soil data</span></span>
<span><span class="va">soils_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SNAM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">unique</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>After intersection with other GIS layers information for them is
added to the soil code. Thus generating new soil type, which have
information about water, impervious layer depth, drainage status as
well. For instance a new code is
<em>S3_S3_SL3_3_&gt;100cm_60-100cm_Y</em>. So the first four elements
stay the same and the last three added should be depth to impervious
layers, depth to water level and drainage status classes. It is
important to point out that intersection with GIS layers in this example
increased number of unique soil types from 171 to 542 and a new soil
type distribution GIS data have been created.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Example of new soil codes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                            SNAM</span></span>
<span><span class="co">## 3 SL3_SL3_SL3_1_&gt;100cm_&gt;100cm_N</span></span>
<span><span class="co">## 5 SL4_SL4_SL4_3_&gt;100cm_&gt;100cm_N</span></span>
<span><span class="co">## 6 SL3_SL3_SL3_2_&gt;100cm_&gt;100cm_N</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Praparing figure of new soil data</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">soils</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SNAM</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p4</span>, <span class="va">p5</span>, ncol <span class="op">=</span> <span class="fl">2</span>,  </span>
<span>                   labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Original soil map'</span>, <span class="st">'New soil map'</span><span class="op">)</span>, </span>
<span>                   label_x <span class="op">=</span> <span class="fl">0</span>, label_y <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, label_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_layer2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="preparing-initial-user-soil-table">Preparing initial user soil table<a class="anchor" aria-label="anchor" href="#preparing-initial-user-soil-table"></a>
</h3>
<p>This part prepares input for the following <a href="#par_make">parameter generation part</a>, which actually uses
<code>svatools</code> package functions to populate usersoil table.
Workflow provided up to here was done to form input to
<em>usertable</em>, which could be used with <a href="../reference/get_soil_parameters.html">get_soil_parameters</a> and
<a href="../reference/get_hsg.html">get_hsg</a> functions. However, such
this information could be prepared with other means than R, which might
be more convenient to user and then loaded into R environment. The only
requirements for table to have these parameters filled:</p>
<ul>
<li>
<em>SNAM</em> soil type text with last three parts separated by
**_** representing impervious layer, water level and drainage
classes;</li>
<li>
<em>NLAYERS</em> numeric value for soil type representing number of
soil layers;</li>
<li>For each layer in soil type profile:
<ul>
<li>
<em>SOL_Z</em> numeric value for soil layer to represent max depth
of soil layer;</li>
<li>
<em>SAND</em> numeric sand content in %;</li>
<li>
<em>SILT</em> numeric silt content in %;</li>
<li>
<em>CLAY</em> numeric clay content in %;</li>
<li>
<em>OC</em> numeric organic content in %.</li>
</ul>
</li>
</ul>
<p>The example below demonstrates how data from lookup tables could be
used to populate initial <em>usertable</em> and how it should look
before generating other parameters. In our case all soil types had three
layers with same depth. So this information added with
<code>mutate</code> function. Then according textural classes lookup
information was added to table with <code>left_join</code>
functions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">SNAM</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr1"</span>, <span class="st">"Lyr2"</span>, <span class="st">"Lyr3"</span>, <span class="st">"Humus"</span>, <span class="st">"Impervious"</span>, <span class="st">"Depth"</span>, <span class="st">"Drained"</span><span class="op">)</span>, <span class="st">"_"</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NLAYERS <span class="op">=</span> <span class="fl">3</span>, </span>
<span>         SOL_Z1 <span class="op">=</span> <span class="fl">250</span>,</span>
<span>         SOL_Z2 <span class="op">=</span> <span class="fl">750</span>,</span>
<span>         SOL_Z3 <span class="op">=</span> <span class="fl">1500</span>,</span>
<span>         Humus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Humus</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gran</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr1"</span> <span class="op">=</span> <span class="st">"Texture EN1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gran</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr2"</span> <span class="op">=</span> <span class="st">"Texture EN2"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gran</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"3"</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr3"</span> <span class="op">=</span> <span class="st">"Texture EN3"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">humus</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Humus"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SNAM</span>, <span class="va">NLAYERS</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"1"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"2"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"3"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Lyr"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">##Renaming OC column to SOL_CBN</span></span>
<span><span class="va">sol_oc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"OC&gt;*"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_at</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">sol_oc</span><span class="op">)</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"OC"</span>, <span class="st">"SOL_CBN"</span>, <span class="va">sol_oc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##Printing structure example of the required table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    542 obs. of  17 variables:</span></span>
<span><span class="co">##  $ SNAM    : chr  "SL3_SL3_SL3_1_&gt;100cm_&gt;100cm_N" "SL4_SL4_SL4_3_&gt;100cm_&gt;100cm_N" "SL3_SL3_SL3_2_&gt;100cm_&gt;100cm_N" "SL2_SL4_SL4_2_&gt;100cm_&gt;100cm_N" ...</span></span>
<span><span class="co">##  $ NLAYERS : num  3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">##  $ SOL_Z1  : num  250 250 250 250 250 250 250 250 250 250 ...</span></span>
<span><span class="co">##  $ SAND1   : num  62.5 60.5 62.5 71.7 80.7 ...</span></span>
<span><span class="co">##  $ SILT1   : num  25.4 27.8 25.4 22.1 14.8 ...</span></span>
<span><span class="co">##  $ CLAY1   : num  12.07 11.69 12.07 6.11 4.45 ...</span></span>
<span><span class="co">##  $ SOL_CBN1: num  1.88 1.26 1.63 1.63 1.63 ...</span></span>
<span><span class="co">##  $ SOL_Z2  : num  750 750 750 750 750 750 750 750 750 750 ...</span></span>
<span><span class="co">##  $ SAND2   : num  62.5 60.5 62.5 60.5 80.7 ...</span></span>
<span><span class="co">##  $ SILT2   : num  25.4 27.8 25.4 27.8 14.8 ...</span></span>
<span><span class="co">##  $ CLAY2   : num  12.07 11.69 12.07 11.69 4.45 ...</span></span>
<span><span class="co">##  $ SOL_CBN2: num  0.942 0.628 0.814 0.814 0.814 ...</span></span>
<span><span class="co">##  $ SOL_Z3  : num  1500 1500 1500 1500 1500 1500 1500 1500 1500 1500 ...</span></span>
<span><span class="co">##  $ SAND3   : num  62.5 60.5 62.5 60.5 62.5 ...</span></span>
<span><span class="co">##  $ SILT3   : num  25.4 27.8 25.4 27.8 25.4 ...</span></span>
<span><span class="co">##  $ CLAY3   : num  12.1 11.7 12.1 11.7 12.1 ...</span></span>
<span><span class="co">##  $ SOL_CBN3: num  0.174 0.116 0.151 0.151 0.151 ...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="par_make">Adding soil parameters to user table<a class="anchor" aria-label="anchor" href="#par_make"></a>
</h3>
<p>This section is the only required part and is the essence of the
workflow. In it <a href="../reference/get_soil_parameters.html">get_soil_parameters</a> is
filling all required SWAT+ parameters for exception of <a href="#par_make2">Hydrologic Soil Groups</a>, which is added in a loop
with <a href="../reference/get_hsg.html">get_hsg</a> function. <a href="../reference/get_soil_parameters.html">get_soil_parameters</a>
function is very straightforward, if input data is formatted
correctly.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Adding all SWAT soil parameters for except HYDGRP  </span></span>
<span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_soil_parameters.html">get_soil_parameters</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="overwritting-with-measured-parameters">Overwritting with measured parameters<a class="anchor" aria-label="anchor" href="#overwritting-with-measured-parameters"></a>
</h3>
<p>In case some soil types do have have required soil parameters <a href="../reference/get_soil_parameters.html">get_soil_parameters</a>
function results can be overwritten. Example below provides example data
and code to be used for replacing parameters in the generated user
table.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Example data loaded to be used for overwriting parameters in the user table</span></span>
<span><span class="va">rep_pars_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"soil_parameters.xlsx"</span>, package <span class="op">=</span> <span class="st">"svatools"</span><span class="op">)</span></span>
<span><span class="va">replace_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">rep_pars_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Extracting soil type codes for each soil layer </span></span>
<span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="va">SNAM</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr1"</span>, <span class="st">"Lyr2"</span>, <span class="st">"Lyr3"</span>, <span class="st">"LyrX"</span><span class="op">)</span>, <span class="st">"_"</span>, extra <span class="op">=</span> <span class="st">"merge"</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">##Replacing values for selected soil types</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Emt"</span>, <span class="st">"Mpl"</span>, <span class="st">"Tn"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">##Selected soil layers</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">##Selected parameters</span></span>
<span>    <span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SOL_Z"</span>, <span class="st">"SOL_BD"</span>, <span class="st">"SOL_AWC"</span>, <span class="st">"SOL_K"</span>, <span class="st">"SOL_CBN"</span>, <span class="st">"CLAY"</span>, </span>
<span>                   <span class="st">"SILT"</span>, <span class="st">"SAND"</span>, <span class="st">"ROCK"</span>, <span class="st">"SOL_ALB"</span>, <span class="st">"USLE_K"</span>, <span class="st">"SOL_EC"</span><span class="op">)</span>,<span class="va">l</span><span class="op">)</span></span>
<span>    <span class="va">usertable</span><span class="op">[</span><span class="va">usertable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Lyr"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span> <span class="op">==</span> <span class="va">p</span>, <span class="va">mp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">replace_pars</span><span class="op">[</span><span class="va">replace_pars</span><span class="op">[</span><span class="st">"SNAM"</span><span class="op">]</span> <span class="op">==</span> <span class="va">p</span>, <span class="va">mp</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">##Removing columns with soil types for each layer</span></span>
<span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Lyr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="par_make2">Adding Hydrologic Soil Groups<a class="anchor" aria-label="anchor" href="#par_make2"></a>
</h3>
<p><a href="../reference/get_hsg.html">get_hsg</a> function require an
assemblance of information per each soil type. A simple example
<em>get_hsg(d_imp = “&gt;100cm”, d_wtr = “&lt;60cm”, drn = “Y”,
data.frame(SOL_K1 = 10, SOL_K2 = 1, SOL_Z1 = 250, SOL_Z2 = 700))</em>.
The first three class values (impervious layer, water level and drainage
status) extracted from soil name (SNAM) and the last is one line
dataframe extracted from <em>usertable</em> with all <em>SOL_K</em> and
<em>SOL_Z</em> parameters available for a soil type.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Adding HYDGRP in a look for each row</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="../reference/get_hsg.html">get_hsg</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">$</span><span class="va">SNAM</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>                    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">$</span><span class="va">SNAM</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>, </span>
<span>                    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">$</span><span class="va">SNAM</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>, </span>
<span>                    <span class="va">usertable</span><span class="op">[</span><span class="va">i</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"SOL_Z"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">usertable</span><span class="op">$</span><span class="va">NLAYERS</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"SOL_K"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">usertable</span><span class="op">$</span><span class="va">NLAYERS</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">usertable</span><span class="op">$</span><span class="va">HYDGRP</span> <span class="op">&lt;-</span> <span class="va">c</span></span>
<span><span class="co">##Printing example of results.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   OBJECTID MUID SEQN                          SNAM S5ID CMPPCT NLAYERS HYDGRP</span></span>
<span><span class="co">## 1        1         1 SL3_SL3_SL3_1_&gt;100cm_&gt;100cm_N           1       3      C</span></span>
<span><span class="co">## 2        2         1 SL4_SL4_SL4_3_&gt;100cm_&gt;100cm_N           1       3      C</span></span>
<span><span class="co">## 3        3         1 SL3_SL3_SL3_2_&gt;100cm_&gt;100cm_N           1       3      C</span></span>
<span><span class="co">##   SOL_ZMX ANION_EXCL SOL_CRK TEXTURE SOL_Z1  SOL_BD1  SOL_AWC1    SOL_K1</span></span>
<span><span class="co">## 1    1500        0.5     0.5            250 1.425086 0.1924849 10.510002</span></span>
<span><span class="co">## 2    1500        0.5     0.5            250 1.495756 0.1822423  7.575023</span></span>
<span><span class="co">## 3    1500        0.5     0.5            250 1.452815 0.1906075  8.086901</span></span>
<span><span class="co">##   SOL_CBN1    CLAY1    SILT1    SAND1 ROCK1  SOL_ALB1   USLE_K1 SOL_EC1</span></span>
<span><span class="co">## 1 1.883721 12.06641 25.39313 62.54047     0 0.1577858 0.1967866       0</span></span>
<span><span class="co">## 2 1.255814 11.69125 27.84219 60.46656     0 0.1578581 0.2294801       0</span></span>
<span><span class="co">## 3 1.633721 12.06641 25.39313 62.54047     0 0.1578682 0.2026279       0</span></span>
<span><span class="co">##   SOL_CAL1 SOL_PH1 SOL_Z2  SOL_BD2  SOL_AWC2    SOL_K2  SOL_CBN2    CLAY2</span></span>
<span><span class="co">## 1        0       0    750 1.543272 0.1806983  6.295567 0.9418605 12.06641</span></span>
<span><span class="co">## 2        0       0    750 1.592254 0.1648706 12.590890 0.6279070 11.69125</span></span>
<span><span class="co">## 3        0       0    750 1.563353 0.1825428  5.016399 0.8139535 12.06641</span></span>
<span><span class="co">##      SILT2    SAND2 ROCK2  SOL_ALB2   USLE_K2 SOL_EC2 SOL_CAL2 SOL_PH2 SOL_Z3</span></span>
<span><span class="co">## 1 25.39313 62.54047     0 0.1652894 0.2385587       0        0       0   1500</span></span>
<span><span class="co">## 2 27.84219 60.46656     0 0.1599742 0.2604019       0        0       0   1500</span></span>
<span><span class="co">## 3 25.39313 62.54047     0 0.1634337 0.2443058       0        0       0   1500</span></span>
<span><span class="co">##    SOL_BD3  SOL_AWC3    SOL_K3  SOL_CBN3    CLAY3    SILT3    SAND3 ROCK3</span></span>
<span><span class="co">## 1 1.682941 0.1520267  5.919946 0.1744186 12.06641 25.39313 62.54047     0</span></span>
<span><span class="co">## 2 1.706045 0.1406651 16.205676 0.1162791 11.69125 27.84219 60.46656     0</span></span>
<span><span class="co">## 3 1.691419 0.1512968  7.750282 0.1511628 12.06641 25.39313 62.54047     0</span></span>
<span><span class="co">##    SOL_ALB3   USLE_K3 SOL_EC3 SOL_CAL3 SOL_PH3</span></span>
<span><span class="co">## 1 0.1677820 0.2552865       0        0       0</span></span>
<span><span class="co">## 2 0.1649420 0.2660251       0        0       0</span></span>
<span><span class="co">## 3 0.1675043 0.2553717       0        0       0</span></span></code></pre>
<p>If case of some generated parameters are available (i.e. from field
measurements or local databases), they can be used by overwriting
generated parameters in the <em>usertable</em>. In our example we had
map of soil hydrological groups. It was used to overwrite results from
calculation with <a href="../reference/get_hsg.html">get_hsg</a>
function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Joining GIS data to generated usertable</span></span>
<span><span class="va">soilp</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">usertable</span>, by <span class="op">=</span> <span class="st">"SNAM"</span><span class="op">)</span> </span>
<span><span class="co">##Plotting soil hydrologic groups obtained from get_hsg function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"HYDGRP"</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"HYDGRP obtained with get_hsg function"</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_hsg_update-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plotting soil hydrologic groups obtained local hydgrp map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hsg</span><span class="op">[</span><span class="st">"hsg"</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"HYDGRP from field data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_hsg_update-2.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Overwriting generated data with values from field data source</span></span>
<span><span class="va">soilp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">soilp</span>, <span class="va">hsg</span>, join <span class="op">=</span> <span class="va">st_overlaps</span>, left <span class="op">=</span> <span class="cn">TRUE</span>, largest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>HYDGRP <span class="op">=</span> <span class="va">hsg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">hsg</span><span class="op">)</span></span>
<span><span class="co">##Plotting updated data result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"HYDGRP"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_hsg_update-3.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="checking-results-on-a-map">Checking results on a map<a class="anchor" aria-label="anchor" href="#checking-results-on-a-map"></a>
</h3>
<p>After generation of all required soil parameters checking of results
on a map is a good practice, which could help to spot various issues and
validate results. Below are just few examples.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plot soil sol_k for the top layer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"SOL_K1"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_maps-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plot soil sol_k for the top layer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"USLE_K1"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_maps-2.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plot soil sol_awc for the top layer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"SOL_AWC1"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_maps-3.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="write-inputs-for-swat">Write inputs for SWAT+<a class="anchor" aria-label="anchor" href="#write-inputs-for-swat"></a>
</h3>
<p>The very last step is to write SWAT+ input data: raster layer (in our
case named as <em>‘SoilmapSWAT.tif’</em>), linkage table between raster
codes and soil type codes (<em>‘Soil_SWAT_cod.csv’</em>) and
<em>usersoil</em> table (<em>‘usersoil_lrew.csv’</em>). DEM data in this
step is used to help rastarize soil types distribution to grid, which
will be used by setup preparation algorithms.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading catchment DEM raster data</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="va">DEM_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_output-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Merging unique soil types into one row and multipolygon</span></span>
<span><span class="va">soils_dis</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SNAM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SOIL_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,</span>
<span>         SNAME <span class="op">=</span> <span class="va">SNAM</span><span class="op">)</span></span>
<span><span class="co">##Rasterizing soil type data</span></span>
<span><span class="va">soils_raster</span> <span class="op">&lt;-</span> <span class="va">soils_dis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html" class="external-link">st_rasterize</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soils_raster</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_output-2.png" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparing linkage table</span></span>
<span><span class="va">soil_link_table</span> <span class="op">&lt;-</span> <span class="va">soils_dis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SOIL_ID</span>, <span class="va">SNAME</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soil_link_table</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">##   SOIL_ID SNAME                        </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1       Emt_Emt_Emt_1_&gt;100cm_&lt;60cm_N </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 2       Emt_Emt_Emt_1_&gt;100cm_&lt;60cm_Y </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 3       Emt_Emt_Emt_1_&gt;100cm_&gt;100cm_N</span></span></code></pre>
<p><code>write_stars</code> function from <code>stars</code> package
could be used to write raster file and <code>write.csv</code> R base
function to write <em>.csv</em> files.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Extending table from 3 to 10 layers (needed by SWATbuildR)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">usertable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SOL_Z"</span>, <span class="st">"SOL_BD"</span>, <span class="st">"SOL_AWC"</span>, <span class="st">"SOL_K"</span>, <span class="st">"SOL_CBN"</span>, <span class="st">"CLAY"</span>, <span class="st">"SILT"</span>, <span class="st">"SAND"</span>, <span class="st">"ROCK"</span>, </span>
<span>                  <span class="st">"SOL_ALB"</span>, <span class="st">"USLE_K"</span>, <span class="st">"SOL_EC"</span>, <span class="st">"SOL_CAL"</span>, <span class="st">"SOL_PH"</span><span class="op">)</span>, <span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="op">}</span></span>
<span><span class="co">##Writing files</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/write_stars.html" class="external-link">write_stars</a></span><span class="op">(</span><span class="va">soils_raster</span> , <span class="st">"../output/SoilmapSWAT.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">soil_link_table</span>, <span class="st">"../output/Soil_SWAT_cod.csv"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="st">"../output/usersoil_lrew.csv"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Svajunas Plunge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
