<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Soil parameters • SWATprepR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Soil parameters">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SWATprepR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.12</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Meteo</h6></li>
    <li><a class="dropdown-item" href="../articles/deposition.html">Atmospheric deposition</a></li>
    <li><a class="dropdown-item" href="../articles/weather.html">Weather data</a></li>
    <li><a class="dropdown-item" href="../articles/climate.html">Climate projections</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Land &amp; Soil</h6></li>
    <li><a class="dropdown-item" href="../articles/soil.html">Soil parameters</a></li>
    <li><a class="dropdown-item" href="../articles/lu.html">Land use</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/psources.html">Point sources</a></li>
    <li><a class="dropdown-item" href="../articles/calibration.html">Calibration data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biopsichas/SWATprepR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Soil parameters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biopsichas/SWATprepR/blob/HEAD/vignettes/soil.Rmd" class="external-link"><code>vignettes/soil.Rmd</code></a></small>
      <div class="d-none name"><code>soil.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Obtaining soil parameters for <a href="https://swatplus.gitbook.io/docs/user/editor/inputs/soils" class="external-link">SWAT+
model</a> can be difficult. Therefore package has functions with allows
automatic preparation of soil parameters. Important theoretical
documentation for the equations is presented in the section 3.4 of <a href="https://doi.org/10.5281/zenodo.7463395" class="external-link">SWAT+ modelling
protocol</a>.</p>
<p>For populating SWAT+ <em>usersoil</em> parameter table <em>SOL_Z</em>
(depth of layer), <em>CLAY</em> (percentage of clay defined as particles
&lt;2
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">\mu m</annotation></semantics></math>),
<em>SAND</em> (percentage of sand - 50–2000
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">\mu m</annotation></semantics></math>),
<em>SILT</em> (percentage of silt - 2–50
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">\mu m</annotation></semantics></math>)
and <em>OC</em> (same as <em>SOL_CBN</em>, soil organic carbon content
in %) parameters should be collected per each separate soil type
profile’s layer. Other parameters will be filled by <a href="../reference/get_usersoil_table.html">get_usersoil_table</a>. For
assigning Hydrologic Soil Groups tile drainage, water level and
impervious layer depth data are needed.</p>
<p>The preparation of soil data and parameters could be done using
following workflow. However, depending on available types of data,
different steps might needed. This is an example of Polish case study of
<a href="https://www.optain.eu/case-studies-and-actors-involvement/upper-zglowiaczka" class="external-link">Upper
Zglowiaczka in OPTAIN project</a>.</p>
</div>
<div class="section level3">
<h3 id="loading-libraries-and-paths-to-data">Loading libraries and paths to data<a class="anchor" aria-label="anchor" href="#loading-libraries-and-paths-to-data"></a>
</h3>
<p>Workflow presented here needs 6 R packages. However, only
<code>SWATprepR</code> and <code>euptf2</code> libraries are required
for the population of soil parameter’s table with <a href="../reference/get_usersoil_table.html">get_usersoil_table</a>
presented in <a href="#par_make">Adding soil parameters to user
table</a> step. Input for this step could be prepared in various ways.
Here is presented just one of the way to understand better all work
process to develop soil parameters table.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Required</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/biopsichas/SWATprepR" class="external-link">SWATprepR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">euptf2</span><span class="op">)</span></span>
<span><span class="co">##Optional</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Required</span></span>
<span><span class="co">##Path to soil distribution shape file</span></span>
<span><span class="va">soil_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/soils.shp"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span>
<span><span class="co">##Path to soil lookup initial parameters with SOL_Z, CLAY, SILT, OC parameters filled.</span></span>
<span><span class="va">lookup_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"soil_lookup.xlsx"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span>
<span><span class="co">##Path to tile drainage shape file</span></span>
<span><span class="va">drainage_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/drained.shp"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Optional</span></span>
<span><span class="co">##Path to water level depth shape file</span></span>
<span><span class="va">water_l_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/water_level.shp"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span>
<span><span class="co">##Path to DEM raster file</span></span>
<span><span class="va">DEM_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/DEM.tif"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span>
<span><span class="co">##Path to catchment boundary shape file (which in this case used as impervious layer data)</span></span>
<span><span class="va">basin_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/basin.shp"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span>
<span><span class="co">##Path to soil hydro groups (if available)</span></span>
<span><span class="va">hsg_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GIS/hydgrp.shp"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="preparing-input-data">Preparing input data<a class="anchor" aria-label="anchor" href="#preparing-input-data"></a>
</h3>
<p>Lookup table contains two sheets. One about granulometry
(<em>SAND</em>, <em>SILT</em>, <em>CLAY</em> content) of each soil
texture class. Second about humus content in different humus class soils
(distributed through layers), which could be easily recalculated to
organic carbon content (with division by <em>1.72</em> coefficient).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading granulometry lookup information for soil types into dataframe</span></span>
<span><span class="va">gran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">lookup_path</span>, sheet <span class="op">=</span> <span class="st">"SandSiltClay"</span><span class="op">)</span> </span>
<span><span class="co">##Print example of gran table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gran</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">##   `Texture EN`  SAND  SILT  CLAY</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> CL            32.0  42.9 25.1 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> L             52.3  29.4 18.2 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> LS1           87.2  10.3  2.46</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading humus lookup information in to dataframe and converting it into organic carbon %.</span></span>
<span><span class="va">humus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">lookup_path</span>, sheet <span class="op">=</span> <span class="st">"Humus"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>OC1 <span class="op">=</span> <span class="va">`Humus 1st layer [%]`</span><span class="op">/</span><span class="fl">1.72</span>,</span>
<span>         OC2 <span class="op">=</span> <span class="va">`Humus 2nd layer [%]`</span><span class="op">/</span><span class="fl">1.72</span>,</span>
<span>         OC3 <span class="op">=</span> <span class="va">`Humus 3rd layer [%]`</span><span class="op">/</span><span class="fl">1.72</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Humus</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"OC"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##Print example of humus table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">humus</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">##   Humus   OC1   OC2   OC3</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1  1.88 0.942 0.174</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2  1.63 0.814 0.151</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3  1.26 0.628 0.116</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading GIS layers for basin boundary, water level, drainage status, soils (with "Code" column here representing soil types) and soil hydrological groups.</span></span>
<span><span class="co">##All data should be in one coordinate system.</span></span>
<span><span class="co">##Impervious layer is prepared from basin layer as it is below 1 m whole catchment falls into one category. </span></span>
<span><span class="va">impervious</span><span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">basin_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Impervious <span class="op">=</span> <span class="st">"&gt;100cm"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span>
<span><span class="va">water_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">water_l_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span>
<span><span class="va">drainage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">drainage_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span> </span>
<span><span class="va">soils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">soil_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span> </span>
<span><span class="va">hsg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">hsg_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span></span></code></pre></div>
<p>All required GIS input data are presented in the maps below. Polygons
in the impervious layer should have one of three possible categories:
“&lt;50cm”, “50-100cm” and “&gt;100cm”. If no information is available
impervious layer depth could be assumed to be the depth of last soil
layer and then reclassified into one of the three categories. Water
level depth also should have only three categories: “&lt;60cm”,
“60-100cm” and “&gt;100cm”. If information is not available soil types
and land use could serve as a good proxy for this information. For
instance wet areas as wetlands could probably be assigned with
“&lt;60cm” class, areas with dominant organic soils with “60-100cm”,
etc. Drainage status should be divided into two: “Y” for drained areas,
“N” for areas without working tile drains. If no database available,
information about existence of drains might be available in drainage
installation plans.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparing maps for each GIS data</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">impervious</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Impervious</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">water_level</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">drainage</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Drained</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">soils</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Code</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##Combining into one</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, ncol <span class="op">=</span> <span class="fl">2</span>,  </span>
<span>                   labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Impervious depth'</span>, <span class="st">'Water level'</span>, <span class="st">'Drainage status'</span>, <span class="st">'Soil types'</span><span class="op">)</span>, </span>
<span>                   label_x <span class="op">=</span> <span class="fl">0</span>, label_y <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, label_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_print-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="preparing-final-soil-layer">Preparing final soil layer<a class="anchor" aria-label="anchor" href="#preparing-final-soil-layer"></a>
</h3>
<p>The final soil layer should have information added from GIS layers to
soil types. For instance in our example initial soil type code has 4
elements separated by “_“. So it looks as <em>S3_S3_SL3_3</em>. First
three shows texture class of soil granulometry three layers and the last
number humus class.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Printing example of soil codes before intersection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   OBJECTID          Code Shape_Leng Shape_Area</span></span>
<span><span class="co">## 1        1   S3_S3_SL3_3   546.3484  11186.102</span></span>
<span><span class="co">## 2        2  SL2_S3_SL3_3   356.2983   4183.884</span></span>
<span><span class="co">## 3        3 SL3_SL3_SL3_1  2152.1265  99806.207</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Counting number of unique soil types in input soil data</span></span>
<span><span class="va">soils_n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Code</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">unique</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co">##Intersecting soil types with other layers</span></span>
<span><span class="va">soils</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">impervious</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">water_level</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">drainage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SNAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Code</span>, <span class="st">"_"</span>, <span class="va">Impervious</span>, <span class="st">"_"</span>, <span class="va">Depth</span>, <span class="st">"_"</span>, <span class="va">Drained</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SNAM</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">##Dealing with different possible geometries to clean up the layer produced by </span></span>
<span><span class="co">##intersection. Following lines is needed to extract nested geometries and </span></span>
<span><span class="co">##convert them into multipolygons.</span></span>
<span><span class="va">soils_g1</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"GEOMETRYCOLLECTION"</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">st_geometry_type</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_collection_extract.html" class="external-link">st_collection_extract</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"POLYGON"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Selecting only polygons geometry types and converting them into multipolygons.</span></span>
<span><span class="va">soils_g2</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"POINT|LINESTRING|GEOMETRYCOLLECTION"</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry_type.html" class="external-link">st_geometry_type</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Binding all geometries together</span></span>
<span><span class="va">soils</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">soils_g1</span>, <span class="va">soils_g2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">soils</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co">##Counting number of unique soil types in generated soil data</span></span>
<span><span class="va">soils_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SNAM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">unique</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>After intersection with other GIS layers information for them is
added to the soil code. Thus generating new soil type, which have
information about water, impervious layer depth, drainage status as
well. For instance a new code is
<em>S3_S3_SL3_3_&gt;100cm_60-100cm_Y</em>. So the first four elements
stay the same and the last three added should be depth to impervious
layers, depth to water level and drainage status classes. It is
important to point out that intersection with GIS layers in this example
increased number of unique soil types from 171 to 543 and a new soil
type distribution GIS data have been created.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Example of new soil codes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                         SNAM</span></span>
<span><span class="co">## 1 S1_S1_S1_5_&gt;100cm_&gt;100cm_N</span></span>
<span><span class="co">## 2 S1_S1_S1_5_&gt;100cm_&gt;100cm_N</span></span>
<span><span class="co">## 3 S1_S1_S1_5_&gt;100cm_&gt;100cm_N</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparing figure of new soil data</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">soils</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SNAM</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p4</span>, <span class="va">p5</span>, ncol <span class="op">=</span> <span class="fl">2</span>,  </span>
<span>                   labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Original soil map'</span>, <span class="st">'New soil map'</span><span class="op">)</span>, </span>
<span>                   label_x <span class="op">=</span> <span class="fl">0</span>, label_y <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, label_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_layer2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="preparing-initial-user-soil-table">Preparing initial user soil table<a class="anchor" aria-label="anchor" href="#preparing-initial-user-soil-table"></a>
</h3>
<p>This part prepares input for the following <a href="#par_make">parameter generation part</a>, which actually uses
<code>SWATprepR</code> package functions to populate usersoil table.
Workflow provided up to here was done to form input to
<em>usertable</em>, which could be used with <a href="../reference/get_usersoil_table.html">get_usersoil_table</a>
function. However, such this information could be prepared with other
means than R, which might be more convenient to user and then loaded
into R environment. The only requirements for table to have these
parameters filled:</p>
<ul>
<li>
<em>SNAM</em> soil type text with last three parts separated by
**_** representing impervious layer, water level and drainage
classes;</li>
<li>
<em>NLAYERS</em> numeric value for soil type representing number of
soil layers;</li>
<li>For each layer in soil type profile:
<ul>
<li>
<em>SOL_Z</em> numeric value for soil layer to represent max depth
of soil layer;</li>
<li>
<em>SAND</em> numeric sand content in %;</li>
<li>
<em>SILT</em> numeric silt content in %;</li>
<li>
<em>CLAY</em> numeric clay content in %;</li>
<li>
<em>SOL_CBN</em> numeric organic carbon content in %.</li>
</ul>
</li>
</ul>
<p>The example below demonstrates how data from lookup tables could be
used to populate initial <em>usertable</em> and how it should look
before generating other parameters. In our case all soil types had three
layers with same depth. So this information added with
<code>mutate</code> function. Then according textural classes lookup
information was added to table with <code>left_join</code>
functions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">SNAM</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr1"</span>, <span class="st">"Lyr2"</span>, <span class="st">"Lyr3"</span>, <span class="st">"Humus"</span>, <span class="st">"Impervious"</span>, <span class="st">"Depth"</span>, <span class="st">"Drained"</span><span class="op">)</span>, <span class="st">"_"</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NLAYERS <span class="op">=</span> <span class="fl">3</span>, </span>
<span>         SOL_Z1 <span class="op">=</span> <span class="fl">250</span>,</span>
<span>         SOL_Z2 <span class="op">=</span> <span class="fl">750</span>,</span>
<span>         SOL_Z3 <span class="op">=</span> <span class="fl">1500</span>,</span>
<span>         Humus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Humus</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gran</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr1"</span> <span class="op">=</span> <span class="st">"Texture EN1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gran</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr2"</span> <span class="op">=</span> <span class="st">"Texture EN2"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gran</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"3"</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr3"</span> <span class="op">=</span> <span class="st">"Texture EN3"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">humus</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Humus"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Impervious <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">SNAM</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, </span>
<span>         Depth <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">SNAM</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>, </span>
<span>         Drained <span class="op">=</span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">SNAM</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SNAM</span>, <span class="va">NLAYERS</span>, <span class="va">Impervious</span>, <span class="va">Depth</span>, <span class="va">Drained</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"1"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"2"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"3"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Lyr"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Renaming OC column to SOL_CBN</span></span>
<span><span class="va">sol_oc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"OC&gt;*"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_at</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">sol_oc</span><span class="op">)</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"OC"</span>, <span class="st">"SOL_CBN"</span>, <span class="va">sol_oc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##Saving and printing structure example of the required table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="st">"../output/usersoils.csv"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usertable</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    543 obs. of  20 variables:</span></span>
<span><span class="co">##  $ SNAM      : chr  "S1_S1_S1_5_&gt;100cm_&gt;100cm_N" "LS2_S3_SL3_3_&gt;100cm_&gt;100cm_N" "Emt_Emt_Emt_7_&gt;100cm_&gt;100cm_N" "Mpl_S1_S1_8_&gt;100cm_&gt;100cm_N" ...</span></span>
<span><span class="co">##  $ NLAYERS   : num  3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">##  $ Impervious: chr  "&gt;100cm" "&gt;100cm" "&gt;100cm" "&gt;100cm" ...</span></span>
<span><span class="co">##  $ Depth     : chr  "&gt;100cm" "&gt;100cm" "&gt;100cm" "&gt;100cm" ...</span></span>
<span><span class="co">##  $ Drained   : chr  "N" "N" "N" "N" ...</span></span>
<span><span class="co">##  $ SOL_Z1    : num  250 250 250 250 250 250 250 250 250 250 ...</span></span>
<span><span class="co">##  $ SAND1     : num  95.4 80.7 0 89 74.5 ...</span></span>
<span><span class="co">##  $ SILT1     : num  3.46 14.84 0 6 19.61 ...</span></span>
<span><span class="co">##  $ CLAY1     : num  1.15 4.45 50 5 5.86 ...</span></span>
<span><span class="co">##  $ SOL_CBN1  : num  0.628 1.256 8.721 5.814 1.256 ...</span></span>
<span><span class="co">##  $ SOL_Z2    : num  750 750 750 750 750 750 750 750 750 750 ...</span></span>
<span><span class="co">##  $ SAND2     : num  95.4 87.3 0 95.4 62.5 ...</span></span>
<span><span class="co">##  $ SILT2     : num  3.46 10.04 0 3.46 25.39 ...</span></span>
<span><span class="co">##  $ CLAY2     : num  1.15 2.65 50 1.15 12.07 ...</span></span>
<span><span class="co">##  $ SOL_CBN2  : num  0.314 0.628 4.36 2.907 0.628 ...</span></span>
<span><span class="co">##  $ SOL_Z3    : num  1500 1500 1500 1500 1500 1500 1500 1500 1500 1500 ...</span></span>
<span><span class="co">##  $ SAND3     : num  95.4 62.5 0 95.4 62.5 ...</span></span>
<span><span class="co">##  $ SILT3     : num  3.46 25.39 0 3.46 25.39 ...</span></span>
<span><span class="co">##  $ CLAY3     : num  1.15 12.07 50 1.15 12.07 ...</span></span>
<span><span class="co">##  $ SOL_CBN3  : num  0.0581 0.1163 0.8721 0.5814 0.1163 ...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="par_make">Adding soil parameters to user table<a class="anchor" aria-label="anchor" href="#par_make"></a>
</h3>
<p>This section is the only required part and is the essence of the
workflow. In it <a href="../reference/get_usersoil_table.html">get_usersoil_table</a>
function is filling all required SWAT+ parameters. If input data is
formatted correctly, function is very straightforward. It requires only
prepared <em>csv</em> file.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_usersoil_table.html">get_usersoil_table</a></span><span class="op">(</span><span class="st">"../output/usersoils.csv"</span>, hsg <span class="op">=</span> <span class="cn">TRUE</span>, keep_values <span class="op">=</span> <span class="cn">FALSE</span>, nb_lyr <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Soil hydrological groups were calculated."</span></span>
<span><span class="co">## [1] "Adding additional 7 layer(s) added."</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="overwritting-with-measured-parameters">Overwritting with measured parameters<a class="anchor" aria-label="anchor" href="#overwritting-with-measured-parameters"></a>
</h3>
<p>In case some soil types do have have required soil parameters <a href="../reference/get_usersoil_table.html">get_usersoil_table</a>
function results can be overwritten. Example below provides example data
and code to be used for replacing parameters in the generated user
table. However, the same could be achieved with
<code>keep_values = TRUE</code> in <a href="../reference/get_usersoil_table.html">get_usersoil_table</a>
function, if data were provided in <em>‘usersoils.csv’</em> file used as
input for the function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Example data loaded to be used for overwriting parameters in the user table</span></span>
<span><span class="va">rep_pars_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"soil_parameters.xlsx"</span>, package <span class="op">=</span> <span class="st">"SWATprepR"</span><span class="op">)</span></span>
<span><span class="va">replace_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">rep_pars_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Extracting soil type codes for each soil layer </span></span>
<span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="va">SNAM</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lyr1"</span>, <span class="st">"Lyr2"</span>, <span class="st">"Lyr3"</span>, <span class="st">"LyrX"</span><span class="op">)</span>, <span class="st">"_"</span>, extra <span class="op">=</span> <span class="st">"merge"</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">##Replacing values for selected soil types</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Emt"</span>, <span class="st">"Mpl"</span>, <span class="st">"Tn"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">##Selected soil layers</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">##Selected parameters</span></span>
<span>    <span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SOL_Z"</span>, <span class="st">"SOL_BD"</span>, <span class="st">"SOL_AWC"</span>, <span class="st">"SOL_K"</span>, <span class="st">"SOL_CBN"</span>, <span class="st">"CLAY"</span>, </span>
<span>                   <span class="st">"SILT"</span>, <span class="st">"SAND"</span>, <span class="st">"ROCK"</span>, <span class="st">"SOL_ALB"</span>, <span class="st">"USLE_K"</span>, <span class="st">"SOL_EC"</span><span class="op">)</span>,<span class="va">l</span><span class="op">)</span></span>
<span>    <span class="va">usertable</span><span class="op">[</span><span class="va">usertable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Lyr"</span>,<span class="va">l</span><span class="op">)</span><span class="op">]</span> <span class="op">==</span> <span class="va">p</span>, <span class="va">mp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">replace_pars</span><span class="op">[</span><span class="va">replace_pars</span><span class="op">[</span><span class="st">"SNAM"</span><span class="op">]</span> <span class="op">==</span> <span class="va">p</span>, <span class="va">mp</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">##Removing columns with soil types for each layer</span></span>
<span><span class="va">usertable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">usertable</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Lyr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If case of some parameters are available from GIS data (i.e. from
field measurements or local databases), they can be used by overwriting
generated parameters in the <em>usertable</em>. In our example we had
map of soil hydrological groups. It was used to overwrite results from
<a href="../reference/get_soil_parameters.html">get_soil_parameters</a>
function.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Joining GIS data to generated usertable</span></span>
<span><span class="va">soilp</span> <span class="op">&lt;-</span> <span class="va">soils</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">usertable</span>, by <span class="op">=</span> <span class="st">"SNAM"</span><span class="op">)</span> </span>
<span><span class="co">##Plotting soil hydrologic groups obtained from get_usersoil_table function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"HYDGRP"</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"HYDGRP obtained with get_usersoil_table function"</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_hsg_update-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plotting soil hydrologic groups obtained local hydgrp map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hsg</span><span class="op">[</span><span class="st">"hsg"</span><span class="op">]</span>, main<span class="op">=</span><span class="st">"HYDGRP from field data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_hsg_update-2.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Overwriting generated data with values from field data source</span></span>
<span><span class="va">soilp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">soilp</span>, <span class="va">hsg</span>, join <span class="op">=</span> <span class="va">st_overlaps</span>, left <span class="op">=</span> <span class="cn">TRUE</span>, largest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>HYDGRP <span class="op">=</span> <span class="va">hsg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">hsg</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Updating soil type names with hydrologic groups as to save this information, </span></span>
<span><span class="co">##in following steps.</span></span>
<span><span class="va">soilp</span><span class="op">$</span><span class="va">SNAM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">$</span><span class="va">SNAM</span>, <span class="st">"_"</span>, <span class="va">soilp</span><span class="op">$</span><span class="va">HYDGRP</span><span class="op">)</span></span>
<span><span class="co">##Plotting updated data result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"HYDGRP"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_hsg_update-3.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="checking-results-on-a-map">Checking results on a map<a class="anchor" aria-label="anchor" href="#checking-results-on-a-map"></a>
</h3>
<p>After generation of all required soil parameters checking of results
on a map is a good practice, which could help to spot various issues and
validate results. Below are just few examples.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plot soil sol_k for the top layer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"SOL_K1"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_maps-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plot soil sol_k for the top layer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"USLE_K1"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_maps-2.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Plot soil sol_awc for the top layer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soilp</span><span class="op">[</span><span class="st">"SOL_AWC1"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_maps-3.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="write-inputs-for-swat">Write inputs for SWAT+<a class="anchor" aria-label="anchor" href="#write-inputs-for-swat"></a>
</h3>
<p>The very last step is to write SWAT+ input data: raster layer (in our
case named as <em>‘SoilmapSWAT.tif’</em>), linkage table between raster
codes and soil type codes (<em>‘Soil_SWAT_cod.csv’</em>) and
<em>usersoil</em> table (<em>‘usersoil_lrew.csv’</em>). DEM data in this
step is used to help rastarize soil types distribution to grid, which
will be used by setup preparation algorithms.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Reading catchment DEM raster data</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="va">DEM_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_output-1.png" width="700"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Merging unique soil types into one row and multipolygon</span></span>
<span><span class="va">soils_dis</span> <span class="op">&lt;-</span> <span class="va">soilp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SNAM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SOIL_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,</span>
<span>          SNAME <span class="op">=</span> <span class="va">SNAM</span><span class="op">)</span></span>
<span><span class="co">##Rasterizing soil type data</span></span>
<span><span class="va">soils_raster</span> <span class="op">&lt;-</span> <span class="va">soils_dis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_rasterize.html" class="external-link">st_rasterize</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">soils_raster</span><span class="op">)</span></span></code></pre></div>
<p><img src="soil_files/figure-html/soil_output-2.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparing linkage table</span></span>
<span><span class="va">soil_link_table</span> <span class="op">&lt;-</span> <span class="va">soils_dis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>`Soil full name` <span class="op">=</span> <span class="va">SNAM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SNAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="va">SOIL_ID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co">## rename soil codes as SWAT+ takes max 20 chr.</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SOIL_ID</span>, <span class="va">SNAM</span>, <span class="va">`Soil full name`</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soil_link_table</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   SOIL_ID SNAM  `Soil full name`              </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1       s1    Emt_Emt_Emt_1_&gt;100cm_&lt;60cm_N_A</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 2       s2    Emt_Emt_Emt_1_&gt;100cm_&lt;60cm_N_B</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 3       s3    Emt_Emt_Emt_1_&gt;100cm_&lt;60cm_Y_B</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Preparing updated user soil table</span></span>
<span><span class="va">usertable_to_save</span> <span class="op">&lt;-</span> <span class="va">soil_link_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">soilp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Soil full name"</span> <span class="op">=</span> <span class="st">"SNAM"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">SNAM</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>OBJECTID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">SOIL_ID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">OBJECTID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">OBJECTID</span>, <span class="va">MUID</span>,<span class="va">SEQN</span>,<span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SOIL_ID"</span>, <span class="st">"Soil full name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>write_stars</code> function from <code>stars</code> package
could be used to write raster file and <code>write.csv</code> R base
function to write <em>.csv</em> files.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Writing files</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/write_stars.html" class="external-link">write_stars</a></span><span class="op">(</span><span class="va">soils_raster</span> , <span class="st">"../output/SoilmapSWAT.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">soil_link_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>, <span class="st">"../output/Soil_SWAT_cod.csv"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">usertable_to_save</span>, <span class="st">"../output/usersoil_lrew.csv"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Saving short soil names link to full names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">soil_link_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>, <span class="st">"../output/Soil_short_to_full.csv"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Svajunas Plunge.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
